<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/app_hs.css">
    <link rel="stylesheet" href="css/fridge_contents.css">
    <title>Fridge contents</title>
</head>
<body>
    <nav>
        <nav id='menu'>
            <input type='checkbox' id='responsive-menu' onclick='updatemenu()'>
            <ul>
                <li>
                    <img class="logo" src="img/logo.png" alt="">
                </li>
                <li class="nav-link">
                    <a class="nav-link"  href='app_homescreen.html'>Home</a>
                </li>
                <li class="nav-link">
                    <a class="nav-link" href='fridge_contents.html'>Fridge contents</a>
                </li>
                <li class="nav-link">
                    <a class="nav-link" href='sharing_is_caring.html'>Sharing is caring</a>
                </li>
                <li class="nav-link">
                    <a class="nav-link" href='shopping_list.html'>Shopping list</a>
                </li>
                <li class="nav-link">
                    <a class="nav-link" href='recipes.html'>Recipes</a>
                </li>
            </ul>
          </nav>
          <!-- Hier komt site specefieke informatie te staan -->
          <div>
            <input type="text" id="text" placeholder="Typ hier de nummers bij de barcode..">
            <button>click</button>
          </div>
          <div class="product-cards-container"></div>
          <script>
            const button = document.querySelector("button");
            button.addEventListener("click", searchProduct);
            let products = JSON.parse(localStorage.getItem('products')) || []

            function searchProduct(event) {
                event.preventDefault();
                const input = document.getElementById("text")
                const barcode = input.value;
                fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}/product.json`)
                    .then(response => response.json())
                    .then(data => {
                        // Check if a product with the same barcode already exists in the array
                        const existingProduct = products.find(product => product.barcode === barcode);
                        if (!existingProduct) {
                            const product = {
                                name: data.product.product_name,
                                image: data.product.image_front_thumb_url,
                                expiration_date: data.product.expiration_date,
                                href: data.product.url,
                                barcode: barcode
                            }
                            products.push(product)
                            localStorage.setItem('products', JSON.stringify(products));
                            displayProducts(products)
                        } else {
                            console.log('Product already exists in the array.');
                        }
                    });
            }

            window.onload = function() {
                let products = JSON.parse(localStorage.getItem('products')) || []
                displayProducts(products)
            }

            function displayProducts(products) {
                products.forEach((product, index) => {
                    // Create a new div element for the product card
                    const div = document.createElement("div");
                    div.classList.add("product-card");

                    // Add the name, description, and image to the product card
                    div.innerHTML = `
                        <div class="textbox"><h2 id="top">${product.name}</h2><button class="delete-button">Delete</button><div>
                        <div class="textbox"><a href="${product.href}"><img src="${product.image}" alt="${product.name}"></a><div>
                        <div class="textbox"><p id="bottom">${product.expiration_date}</p><div>
                    `;

                    // Append the product card to the container element
                    document.querySelector('.product-cards-container').appendChild(div);

                    // Add an event listener to the delete button
                    const deleteButton = div.querySelector('.delete-button');
                    deleteButton.addEventListener('click', () => {
                        // Remove the product from the products array
                        products.splice(index, 1);
                        localStorage.setItem('products', JSON.stringify(products));
                        // Remove the product card from the page
                        div.remove();
                    });
                });
            }

        </script>
        <script src="javascript/activebutton.js">

        </script>
    </nav>
</body>
</html>